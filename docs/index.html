<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>D3 Hello World</title>
    <style>
      path {
        stroke: white;
        stroke-width: 0.5px;
        fill: #778899;
      }
    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
  </head>

  <body>
    <script type="text/javascript">
      var width = 900;
      var height = 1000;

      var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height);

      var cities=[
  		{"code":"BER", "city":"Berlin", "country":"Germany", "lat":52.52, "lon":13.405},
  		{"code":"CGN", "city":"Köln", "country":"Germany", "lat":50.94, "lon":6.96},
  		{"code":"MNC", "city":"München", "country":"Germany", "lat":48.135, "lon":11.58},
  		{"code":"HHB", "city":"Hamburg", "country":"Germany", "lat":53.55, "lon":9.99}
	  ];

      //changing the projection from mercator to albers
      var projection = d3.geo.albers()
      		.center([11,50.7])
      		.rotate([0,0])
      		.parallels([50,10])
      		.scale(4000)
      		.translate([width/2,height/2]);

      var path = d3.geo.path()
          .projection(projection);

      var g = svg.append("g");
      
      d3.json("https://raw.githubusercontent.com/deldersveld/topojson/master/countries/germany/germany-regions.json", function(error, topology) {
          g.selectAll("path")
            .data(topojson.object(topology, topology.objects.DEU_adm2)
                .geometries)
            .enter()
            .append("path")
            .attr("d", path)
            .attr('fill','gray')

               // add city location circles
		  var locations = g.selectAll("circle")
			       .data(cities)
			       .enter()
			       .append("circle")
			       .attr("cx", function(d) {return projection([d.lon, d.lat])[0];})
			       .attr("cy", function(d) {return projection([d.lon, d.lat])[1];})
			       .attr("r", 5)
			       .style("fill", "red")
			       .style("opacity", 0.6)
      });
    

      //zoom and pan functionality
		var zoom = d3.behavior.zoom().on("zoom",function() {
        	g.attr("transform","translate("+ d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        	g.selectAll("path")  
            .attr("d", path.projection(projection)); 
  		});
		svg.call(zoom);



    </script>
  </body>
</html>